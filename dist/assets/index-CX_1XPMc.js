import{j as e,r as p,R as $}from"./react-CFCE4xZu.js";import{c as W}from"./react-dom-C70hEFdC.js";import"./firebase-Re-bnO7p.js";import{i as Y,g as _,a as z,b as J,d as x,c as F,e as L,q as K,w as Q,f as H,s as B,h as V,u as C,j as I,o as M,k as X,l as G,m as Z,n as ee,p as se,t as te,v as ae}from"./@firebase-xipSHlHr.js";import{c as T}from"./zustand-C_CIqD10.js";import{E as re}from"./emoji-picker-react-l-9WTjTY.js";import{B as A,Q as ne}from"./react-toastify-CLoXe84U.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./flairup-CpvKgcza.js";import"./clsx-B-dksMZM.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const ce={apiKey:"AIzaSyAQR0X3oSdgUjIM--0TLRA-Rta_DgJJo5k",authDomain:"just-chat-d93ee.firebaseapp.com",projectId:"just-chat-d93ee",storageBucket:"just-chat-d93ee.appspot.com",messagingSenderId:"24924173027",appId:"1:24924173027:web:7fed16c5187c6a29844bd6"};Y(ce);const k=_(),j=z(),ie=J(),S=T(t=>({currentUser:null,isLoading:!0,fetchUserInfo:async s=>{if(!s)return t({currentUser:null,isLoading:!1});try{const a=x(j,"users",s),c=await F(a);c.exists()?t({currentUser:c.data(),isLoading:!1}):t({currentUser:null,isLoading:!1})}catch(a){return console.log(a),t({currentUser:null,isLoading:!1})}}})),oe=()=>{const{currentUser:t}=S();return e.jsxs("div",{className:"userInfo",children:[e.jsxs("div",{className:"user",children:[e.jsx("img",{src:t.avatar||"./avatar.png",alt:""}),e.jsx("h2",{children:t.username})]}),e.jsxs("div",{className:"icons",children:[e.jsx("img",{src:"../more.png",alt:""}),e.jsx("img",{src:"../video.png",alt:""}),e.jsx("img",{src:"../edit.png",alt:""})]})]})},le=()=>{const[t,s]=p.useState(null),{currentUser:a}=S(),c=async i=>{i.preventDefault();const d=new FormData(i.target).get("username");try{const m=L(j,"users"),h=K(m,Q("username","==",d)),g=await H(h);g.empty||s(g.docs[0].data())}catch(m){console.log(m)}},r=async()=>{const i=L(j,"chats"),o=L(j,"userchats");try{const d=x(i);await B(d,{createdAt:V(),messages:[]}),await C(x(o,t.id),{chats:I({chatId:d.id,lastMessage:"",receiverId:a.id,updatedAt:Date.now()})}),await C(x(o,a.id),{chats:I({chatId:d.id,lastMessage:"",receiverId:t.id,updatedAt:Date.now()})})}catch(d){console.log(d)}};return e.jsxs("div",{className:"addUser",children:[e.jsxs("form",{onSubmit:c,children:[e.jsx("input",{type:"text",placeholder:"username",name:"username"}),e.jsx("button",{children:"Search"})]}),t&&e.jsxs("div",{className:"user",children:[e.jsxs("div",{className:"detail",children:[e.jsx("img",{src:t.avatar||"./avatar.png",alt:""}),e.jsx("span",{children:t.username})]}),e.jsx("button",{onClick:r,children:"Add User"})]})]})},D=T(t=>({chatId:null,user:null,isCurrentUserBlocked:!1,isReceiverBlocked:!1,changeChat:(s,a)=>{const c=S.getState().currentUser;return a.blocked.includes(c.id)?t({chatId:s,user:null,isCurrentUserBlocked:!0,isReceiverBlocked:!1}):c.blocked.includes(a.id)?t({chatId:s,user:a,isCurrentUserBlocked:!1,isReceiverBlocked:!0}):t({chatId:s,user:a,isCurrentUserBlocked:!1,isReceiverBlocked:!1})},changeBlock:()=>{t(s=>({...s,isReceiverBlocked:!s.isReceiverBlocked}))}})),de=()=>{const[t,s]=p.useState([]),[a,c]=p.useState(!1),[r,i]=p.useState(""),{currentUser:o}=S(),{chatId:d,changeChat:m}=D();p.useEffect(()=>{const n=M(x(j,"userchats",o.id),async u=>{const b=u.data().chats.map(async N=>{const v=x(j,"users",N.receiverId),y=(await F(v)).data();return{...N,user:y}}),f=await Promise.all(b);s(f.sort((N,v)=>v.updatedAt-N.updatedAt))});return()=>{n()}},[o.id]);const h=async n=>{const u=t.map(f=>{const{user:N,...v}=f;return v}),w=u.findIndex(f=>f.chatId===n.chatId);u[w].isSeen=!0;const b=x(j,"userchats",o.id);try{await updateDoc(b,{chats:u}),m(n.chatId,n.user)}catch(f){console.log(f)}},g=t.filter(n=>n.user.username.toLowerCase().includes(r.toLowerCase()));return e.jsxs("div",{className:"chatList",children:[e.jsxs("div",{className:"search",children:[e.jsxs("div",{className:"searchBar",children:[e.jsx("img",{src:"./search.png",alt:""}),e.jsx("input",{type:"text",placeholder:"Search",onChange:n=>i(n.target.value)})]}),e.jsx("img",{src:a?"./minus.png":"./plus.png",alt:"",className:"add",onClick:()=>c(n=>!n)})]}),g.map(n=>{n!=null&&n.isSeen,n.user.blocked.includes(o.id)||n.user.avatar,n.user.blocked.includes(o.id)||n.user.username,n.lastMessage,n.chatId}),a&&e.jsx(le,{})]})},ue=()=>e.jsxs("div",{className:"list",children:[e.jsx(oe,{}),e.jsx(de,{})]}),me=()=>{var v;const[t,s]=p.useState(!1),[a,c]=p.useState(""),[r,i]=p.useState(),[o,d]=p.useState({file:null,url:""}),{chatId:m,user:h,isCurrentUserBlocked:g,isReceiverBlocked:n}=D(),{currentUser:u}=S(),w=p.useRef(null);p.useEffect(()=>{var l;(l=w.current)==null||l.scrollIntoView({behaviour:"smooth"})},[]),p.useEffect(()=>{const l=M(x(j,"chats",m),y=>{i(y.data())});return()=>{l()}},[m]);const b=l=>{c(y=>y+l.emoji),s(!1)},f=l=>{l.target.files[0]&&d({file:l.target.files[0],url:URL.createObjectURL(l.target.files[0])})},N=async()=>{if(a==="")return;let l=null;try{o.file&&(l=await upload(o.file)),await C(x(j,"chats",m),{messages:I({senderId:u.id,text:a,createdAt:new Date,...l&&{img:l}})}),[u.id,h.id].forEach(async E=>{const O=x(j,"userchats",E),P=await getDoc(O);if(P.exists()){const U=P.data(),R=U.chats.findIndex(q=>q.chatId===m);U.chats[R].lastMessage=a,U.chats[R].isSeen=E===u.id,U.chats[R].updateAt=Date.now(),await C(O,{chats:U.chats})}})}catch(y){console.log(y)}d({file:null,url:""}),c("")};return e.jsxs("div",{className:"chat",children:[e.jsxs("div",{className:"top",children:[e.jsxs("div",{className:"user",children:[e.jsx("img",{src:(h==null?void 0:h.avatar)||"./avatar.png",alt:""}),e.jsxs("div",{className:"texts",children:[e.jsx("span",{children:h==null?void 0:h.username}),e.jsx("p",{children:"Lorem, ipsum voluptates"})]})]}),e.jsxs("div",{className:"icons",children:[e.jsx("img",{src:"./phone.png",alt:""}),e.jsx("img",{src:"./video.png",alt:""}),e.jsx("img",{src:"./info.png",alt:""})]})]}),e.jsxs("div",{className:"center",children:[(v=r==null?void 0:r.messages)==null?void 0:v.map(l=>{l.senderId,u==null||u.id,l.img&&l.img,l.text,l==null||l.createdAt}),o.url&&e.jsx("div",{className:"message own",children:e.jsx("div",{className:"texts",children:e.jsx("img",{src:"img.Url",alt:""})})}),e.jsx("div",{ref:w})]}),e.jsxs("div",{className:"bottom",children:[e.jsxs("div",{className:"icons",children:[e.jsx("label",{htmlFor:"file",children:e.jsx("img",{src:"./img.png",alt:""})}),e.jsx("input",{type:"file",id:"file",style:{display:"none"},onChange:f}),e.jsx("img",{src:"./camera.png",alt:""}),e.jsx("img",{src:"./mic.png",alt:""})]}),e.jsx("input",{type:"text",placeholder:g||n?"You cannot send a message":"Type a message...",value:a,onChange:l=>c(l.target.value),disabled:g||n}),e.jsxs("div",{className:"emoji",children:[e.jsx("img",{src:"./emoji.png",alt:"",onClick:()=>s(l=>!l)}),e.jsx("div",{className:"picker",children:e.jsx(re,{open:t,onEmojiClick:b})})]}),e.jsx("button",{className:"sendButton",onClick:N,disabled:g||n,children:"Send"})]})]})},he=()=>{const{chatId:t,user:s,isCurrentUserBlocked:a,isReceiverBlocked:c,changeBlock:r}=D(),{currentUser:i}=S(),o=async()=>{if(!s)return;const d=x(j,"users",i.id);try{await C(d,{blocked:c?X(s.id):I(s.id)}),r()}catch(m){console.log(m)}};return e.jsxs("div",{className:"detail",children:[e.jsxs("div",{className:"user",children:[e.jsx("img",{src:(s==null?void 0:s.avatar)||"./avatar.png",alt:""}),e.jsx("h2",{children:s==null?void 0:s.username}),e.jsx("p",{children:"Lorem ipsum dolor sit amet consectetur"})]}),e.jsxs("div",{className:"info",children:[e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Chat Settings"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Privacy & Help"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsxs("div",{className:"option",children:[e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Shared Photos"}),e.jsx("img",{src:"./arrowDown.png",alt:""})]}),e.jsx("div",{className:"photos",children:e.jsxs("div",{className:"photoItem",children:[e.jsxs("div",{className:"photoDetail",children:[e.jsx("img",{src:"./avatar.png",alt:""}),e.jsx("span",{children:"photo_2024.png"})]}),e.jsx("img",{src:"./download.png",alt:"",className:"icon"})]})})]}),e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Shared Fies"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsx("button",{onClick:o,children:a?"You are Blocked":c?"User blocked":"Block User"}),e.jsx("button",{className:"logout",onClick:()=>k.signOut(),children:"Logout"})]})]})},pe=async t=>{const a=G(ie,`images/${new Date+t.name}`),c=Z(a,t);return new Promise((r,i)=>{c.on("state_changed",o=>{const d=o.bytesTransferred/o.totalBytes*100;console.log("Upload is "+d+"% done")},o=>{i("Something went wrong"+o.code)},()=>{ee(c.snapshot.ref).then(o=>{r(o)})})})},ge=()=>{const[t,s]=p.useState({file:null,url:""}),[a,c]=p.useState(!1),r=d=>{d.target.files[0]&&s({file:d.target.files[0],url:URL.createObjectURL(d.target.files[0])})},i=async d=>{d.preventDefault(),c(!0);const m=new FormData(d.target),{username:h,email:g,password:n}=Object.fromEntries(m);try{const u=await se(k,g,n),w=await pe(t.file);await B(x(j,"users",u.user.uid),{username:h,email:g,avatar:w,id:u.user.uid,blocked:{}}),await B(x(j,"userchats",u.user.uid),{chats:[]}),A.success("Account created! You can log in now")}catch(u){console.log(u),A.error("Something Went wrong")}finally{c(!1)}},o=async d=>{d.preventDefault(),c(!0);const m=new FormData(d.target),{email:h,password:g}=Object.fromEntries(m);try{const n=await te(k,h,g)}catch(n){console.log(n),A.error("Invalid details")}finally{c(!1)}};return e.jsxs("div",{className:"login",children:[e.jsxs("div",{className:"item",children:[e.jsx("h2",{children:"Welcome back,"}),e.jsxs("form",{onSubmit:o,children:[e.jsx("input",{type:"email",placeholder:"Email",name:"email"}),e.jsx("input",{type:"password",name:"password",placeholder:"password"}),e.jsx("button",{disabled:a,children:a?"loading":"Sign In"})]})]}),e.jsx("div",{className:"separator"}),e.jsxs("div",{className:"item",children:[e.jsx("h2",{children:"Create an Account"}),e.jsxs("form",{onSubmit:i,children:[e.jsxs("label",{htmlFor:"file",children:[e.jsx("img",{src:t.url||"./avatar.png",alt:""}),"Upload an Image"]}),e.jsx("input",{type:"file",name:"file",id:"file",style:{display:"none"},onChange:r}),e.jsx("input",{type:"text",placeholder:"username",name:"username"}),e.jsx("input",{type:"email",name:"email",placeholder:"Email",id:"email"}),e.jsx("input",{type:"password",name:"password",placeholder:"password",id:"password"}),e.jsx("button",{disabled:a,children:a?"loading":"Sign Up"})]})]})]})},xe=()=>e.jsx("div",{children:e.jsx(ne,{position:"bottom-right"})}),je=()=>{const{currentUser:t,isLoading:s,fetchUserInfo:a}=S(),{chatId:c}=D();return p.useEffect(()=>{const r=ae(k,i=>{a(i==null?void 0:i.uid)});return()=>{r()}},[a]),console.log(t),s?e.jsx("div",{className:"loading",children:"Loading..."}):e.jsxs("div",{className:"container",children:[t?e.jsxs(e.Fragment,{children:[e.jsx(ue,{}),c&&e.jsx(me,{}),c&&e.jsx(he,{})]}):e.jsx(ge,{}),e.jsx(xe,{})]})};W.createRoot(document.getElementById("root")).render(e.jsx($.StrictMode,{children:e.jsx(je,{})}));
